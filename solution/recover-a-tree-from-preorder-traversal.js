/**
 * Definition for a binary tree node.
 * function TreeNode(val) {
 *     this.val = val;
 *     this.left = this.right = null;
 * }
 */
/**
 * @param {string} S
 * @return {TreeNode}
 */

/*
  åˆ©ç”¨æ ˆï¼Œç´¢å¼•ä»£è¡¨æ·±åº¦ï¼Œå€¼ä»£è¡¨èŠ‚ç‚¹
  å­˜å‚¨æ·±åº¦éå†è¿‡ç¨‹ä¸­çš„èŠ‚ç‚¹
  
  æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼Œå…ˆåˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ•°å­—ä¸ºæ ¹èŠ‚ç‚¹
  stack[0] = 1
  æ„æ€æ˜¯ï¼š1 è¿™ä¸ªèŠ‚ç‚¹çš„æ·±åº¦æ˜¯ 0
  
  ç„¶åå†éå† - ï¼Œæ­¤æ—¶å¾—åˆ°ä¿¡æ¯ï¼Œè¿ç»­çš„ '-' çš„é•¿åº¦ä¸º 1ï¼Œä¹Ÿå°±æ˜¯ ä¸‹ä¸€ä¸ªé‡åˆ°çš„æ•°å­— 401 çš„
  èŠ‚ç‚¹æ·±åº¦æ˜¯ 1ï¼Œé‚£ä¹ˆæ­¤æ—¶åˆ¤æ–­ stack çš„æ ˆé¡¶èŠ‚ç‚¹çš„æ·±åº¦æ˜¯ 0ï¼Œ0 åˆšå¥½æ˜¯ 1 çš„çˆ¶äº²çš„æ·±åº¦ï¼Œé‚£ä¹ˆ
  åˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹æ˜¯å¦æœ‰å·¦èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±æŒ‚ä¸Šï¼Œå¦‚æœæœ‰å°±æŒ‚åˆ°å³èŠ‚ç‚¹ï¼Œç„¶åè¿™ä¸ªèŠ‚ç‚¹å…¥æ ˆ
  
  ã€‚ã€‚ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹
  
  å¦‚æœ stack[5] = 17 è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ ˆä¸­ä¿å­˜çš„èŠ‚ç‚¹å€¼ä¸º 17 çš„èŠ‚ç‚¹ï¼Œå®ƒçš„ç´¢å¼•ä¸º 5ï¼Œä»£è¡¨å®ƒ
  çš„æ·±åº¦æ˜¯ 5
  
  ğŸ‘‰çœ‹è¿™ä¸ªæ¡ˆä¾‹ç†è§£ ï¼ï¼ï¼ï¼ï¼ï¼
  ä¸¾ä¾‹ï¼šS: 1-401--349---90--88   stack: []
  1. å…ˆåœ¨å­—ç¬¦ä¸²ä¸­æœç´¢ç¬¬ä¸€ä¸ªæ•°å­—ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œæœç´¢åˆ° 1ï¼Œå…¥æ ˆï¼Œæœç´¢è¿‡çš„éƒ¨åˆ†åœ¨ S ä¸Šæˆªæ‰
     S: -401--349---90--88   stack: [1]
  %: ä¸‹é¢ä¸åœçš„æœç´¢æ·±åº¦ï¼Œæœç´¢æ•°å­—ï¼Œæœç´¢æ·±åº¦ï¼Œæœç´¢æ•°å­—ã€‚ã€‚ã€‚
  2. æœç´¢æ·±åº¦ï¼š'-' æ·±åº¦ä¸º 1ï¼Œé‚£ä¹ˆæ ¹æ®ä¸‹ä¸€ä¸ªæœç´¢å‡ºæ¥çš„å€¼åˆ›å»ºçš„èŠ‚ç‚¹åº”è¯¥æ˜¯æ·±åº¦ä¸º 0 çš„èŠ‚ç‚¹
     çš„å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåšä¸€ä¸ªæ“ä½œï¼Œä¸æ–­åˆ é™¤ stack æ ˆé¡¶çš„èŠ‚ç‚¹ï¼Œä¿è¯æ ˆé¡¶èŠ‚ç‚¹çš„ç´¢å¼•ä¸º 0ï¼Œä¹Ÿå°±æ˜¯
     æ·±åº¦ä¸º 0 çš„èŠ‚ç‚¹ï¼Œè¿™æ ·æ˜¯ä¸ºäº†åœ¨ä¸‹ä¸€è½®æœç´¢æ•°å­—çš„æ—¶å€™ï¼Œæ ¹æ®æ•°å­—åˆ›å»ºèŠ‚ç‚¹å¹¶æŒ‚åˆ°æ·±åº¦ä¸º 0 çš„èŠ‚ç‚¹
     ä¸Š
     S: 401--349---90--88   stack: [1]
  3. æœç´¢æ•°å­—ï¼š'401'ï¼Œé‚£ä¹ˆæ ¹æ®æ•°å­— 401 åˆ›å»ºèŠ‚ç‚¹ï¼ŒæŒ‚åˆ°æ ˆé¡¶å…ƒç´  1 çš„å­èŠ‚ç‚¹ï¼Œå¹¶æŠŠå½“å‰èŠ‚ç‚¹ 401
     å…¥æ ˆï¼Œå› ä¸ºé¢˜ç›®ç»™å‡ºçš„æ˜¯æ·±åº¦éå†çš„ç»“æœï¼Œæ‰€ä»¥ 401 ä¹Ÿæœ‰å¯èƒ½ä½œä¸ºå…¶ä»–èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚æŒ‚ä¸Šå»çš„
     ç­–ç•¥ä¹Ÿå¾ˆç®€å•ï¼Œåˆ¤æ–­çˆ¶èŠ‚ç‚¹æ˜¯å¦æœ‰å·¦èŠ‚ç‚¹ï¼Œæ²¡æœ‰å°±æŒ‚åˆ° parent.left ä¸Šé¢ï¼Œæ²¡æœ‰çš„è¯ï¼Œå°±æŒ‚åˆ°
     parent.right ä¸Š
     S: --349---90--88  stack: [1, 401]
  4. æœç´¢æ·±åº¦ï¼š'--' æ·±åº¦ä¸º 2
     S: 349---90--88   stack: [1, 401]
  5. æœç´¢æ•°å­—ï¼š'349'
     S: ---90--88  stack: [1, 401, 349]
  ã€‚ã€‚ã€‚
*/
var recoverFromPreorder = function (S) {
  let stack = [], root;

  // ä»å­—ç¬¦ä¸²ä¸­è·å–è¿ç»­çš„ '-' ä½œä¸ºæ·±åº¦ï¼Œå¹¶ä¸”è¿”å›è£å‰ªåçš„ str å’Œæ‰¾åˆ°çš„æ·±åº¦
  const getDeep = str => {
    if (!str.startsWith('-')) {
      return {
        target: undefined, S: str
      }
    };
    let deep = 0, i = 0, len = str.length;
    while (i < len && str.charAt(i++) === '-') deep++;
    return {
      target: deep,
      S: str.slice(deep)
    }
  };

  // ä»å­—ç¬¦ä¸²ä¸­è·å–æ•°å­—ï¼Œå¹¶è¿”å›è£å‰ªåçš„ str å’Œ æ‰¾åˆ°çš„æ•°å­—
  const getVal = str => {
    const strNum = '0123456789';
    if (str.length <= 0 || strNum.indexOf(str.charAt(0)) === -1) {
      return {
        target: undefined,
        S: str
      }
    };
    let num = '', i = 0, len = str.length;
    while (i < len && strNum.indexOf(str.charAt(i)) !== -1) {
      num += str.charAt(i);
      i++;
    };
    return {
      target: num === '' ? undefined : Number(num),
      S: str.slice(num.length)
    }
  }

  // æŠŠ num ä½œä¸ºå€¼åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ”¾åˆ° parent ä¸Šé¢
  const saveNode2Parent = (num, stack) => {
    let parent = stack[stack.length - 1];
    let newNode = new TreeNode(num);
    if (!parent.left) {
      parent.left = newNode;
    } else if (!parent.right) {
      parent.right = newNode;
    }
    stack.push(newNode);
  }

  // åˆå§‹åŒ–æ ¹èŠ‚ç‚¹
  let res = getVal(S);
  S = res.S;
  let value = res.target;
  if (value === undefined) return root;

  root = new TreeNode(value);
  stack.push(root);

  // å¼€å§‹å¾ªç¯éå†æ·±åº¦ã€æ•°å­—ã€æ·±åº¦ã€æ•°å­—ã€‚ã€‚ã€‚
  let nextFind = 'deep', // deep: å¯»æ‰¾æ·±åº¦  val: å¯»æ‰¾ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å€¼
    target;
  do {
    if (nextFind === 'deep') { // ä¸‹ä¸€è½®è¦å¯»æ‰¾çš„æ˜¯æ·±åº¦
      let res = getDeep(S);
      S = res.S;
      target = res.target;
      if (target === undefined) return root; // æ ¹èŠ‚ç‚¹å·²ç»æ‰¾åˆ°äº†ï¼Œå†æ¬¡å‡ºç°æ·±åº¦ä¸º 0ï¼Œè¯´æ˜ç”¨ä¾‹æœ‰é—®é¢˜ï¼Œå…¶å®ä¸ä¼šå‡ºç°è¿™æ ·çš„ç”¨ä¾‹
      let deep = target;
      // åˆ åˆ° stack çš„æœ«ä½èŠ‚ç‚¹æ·±åº¦æ˜¯ deep-1ï¼Œä¹Ÿå°±æ˜¯ä¸‹ä¸€æ¬¡æ‰¾åˆ°çš„èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹
      while (stack.length > deep) {
        stack.pop();
      }
    } else { // ä¸‹ä¸€è½®è¦å¯»æ‰¾çš„æ˜¯èŠ‚ç‚¹å€¼
      let res = getVal(S);
      S = res.S;
      target = res.target;
      if (target === undefined) return root;
      saveNode2Parent(target, stack);
    }

    nextFind = nextFind === 'deep' ? 'val' : 'deep'; // åˆ‡æ¢ä¸‹ä¸€è½®è¦æ‰¾çš„ç›®æ ‡ç±»å‹
  } while (target !== undefined);

  return root;
};